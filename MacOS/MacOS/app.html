<html>
  <head>
    <title>MyApp -- (edit this title in app.html)</title>
    <style>
    body {
      font-family: -apple-system, 'Segoe UI Light', Ubuntu, Arial, sans-serif;
    }
        
        
    </style>
  </head>
  <body onload="LoadPorts();">

      <h2> Hello world!</h2>
      <button onclick="Connect();">Connect</button>
      <button onclick="LoadPorts();">Refresh Ports</button>
      <div id="result"></div>
      <div class="settingsContainer">
          <div class="settings">
              <label for="serialPorts">Serial Port</label>
              
              <select name="serialPorts" class="settingsLists">

              </select>
              
          </div>
          <div class="settings">
              <label for="baudRates">Baud</label>
              
              <select name="baudRates" class="settingsLists">
                  <option value="1200">1200</option>
                  <option value="2400">2400</option>
                  <option value="4800">4800</option>
                  <option value="9600">9600</option>
                  <option value="19200">19200</option>
                  <option value="38400">38400</option>
                  <option value="57600">57600</option>
                  <option value="115200">115200</option>
              </select>
          </div>
          <div class="settings">
              <label for="dataBits">Data Bits</label>
              
              <select name="dataBits" class="settingsLists">
                  <option value="7">7</option>
                  <option value="8">8</option>
              </select>
          </div>
          <div class="settings">
              <label for="stopBits">Stop Bits</label>
              
              <select name="stopBits" class="settingsLists">
                  <option value="0">0</option>
                  <option value="1">1</option>
              </select>
          </div>
          <div class="settings">
              <label for="parity">Parity</label>
              
              <select name="parity" class="settingsLists">
                  <option value="N">None</option>
                  <option value="E">Even</option>
                  <option value="O">Odd</option>
              </select>
          </div>
          
          
      
      </div>

      
    </body>

</html>

<script>
    //read the select options as a string and return string
    function GetOptions() {
        var select = document.getElementsByClassName("settingsLists");
        //create empty array to store the values
        var result = "";
        for (var i = 0; i < select.length; i++) {
            result += select[i].value;
            if(i != select.length - 1)
                result += ",";
        }
        return result;
    }

</script>

<script>
    window.onerror = (msg, url, line, column, error) => {
        const message = {
            message: msg,
            url: url,
            line: line,
            column: column,
            error: JSON.stringify(error)
        }
        
        if (window.webkit) {
            window.webkit.messageHandlers.error.postMessage(message);
        } else {
            console.log("Error:", message);
        }
    };
    
    var count = 0;

    var devices = [{}];
    
    function getJsonData() {
        if (window.webkit) {
            window.webkit.messageHandlers.getJsonData.postMessage('');
        } else {
            var jsonStr = [
                           {
                               "name": "ListElement1",
                               "type": "voltage"
                           },
                           {
                               "name": "ListElement2",
                               "type": "oxygen"
                           },
                           {
                               "name": "ListElement3",
                               "type": "algae"
                           },
                           {
                               "name": "ListElement4",
                               "type": "voltage"
                           }
                       ];
            handleJsonData(jsonStr);
        }
    }
    
    // populate listView element with raw data recieved
    function handleJsonData(jsonStr) {
        devices = JSON.parse(jsonStr);
        const list = document.getElementById("device-list");
        
        document.getElementById("test-out").innerHTML = devices.size ;
        
        // create list items
        devices.forEach(item => {
            const listItem = document.createElement('li');
            listItem.textContent = item.name;
            listItem.setAttribute('data-item', JSON.stringify(item));
            list.appendChild(listItem);
            count++;
        });
    }
    
    // call to Swift to LoadPorts()
    function LoadPorts() {
        var docPorts =  document.getElementsByName('serialPorts');
        if (docPorts[0].options.length > 0) removeOptions(docPorts[0]);
        
        if (window.webkit) {
            window.webkit.messageHandlers.LoadPorts.postMessage('');
        }
    }
    
    // refresh options list
    function removeOptions(selectElement) {
        var i, L = selectElement.options.length - 1;
        for (i = L; i >= 0; i--) {
            selectElement.remove(i);
        }
    }
    
    // called by WK with data to populate the webview
    function handlePortsData(ports) {
        var docPorts =  document.getElementsByName('serialPorts');
        for(var i = 0; i < ports.length;i++){
            var optn = document.createElement('OPTION');
            optn.text = ports[i];
            optn.value = ports[i];
            docPorts[0].options.add(optn);
        }
    }
        
    function readInput() {
        var myElement = document.getElementById("inputReg");
        myElement.innerHTML = "Button Clicked.";
    }
    
</script>
